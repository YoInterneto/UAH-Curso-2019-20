grammar snake;

prog: ((funcion|control|llamadafuncion|asignacion|declaracion|include) NEWLINE?)* ;

//FUNCIONES
funcion: header_funcion NEWLINE* cuerpo_funcion;
control: header_control NEWLINE* cuerpo_control; 
llamadafuncion : nombre_funcion parametros basura ;
declaracion : pr_tipo nombre_variable ASIGNAR expr basura ; //la primera vez que instanciamos una variable
asignacion: nombre_variable ASIGNAR expr basura ; //asignar un valor a una variable
bloque : pr_bloque ;
include: pr_include nombre_libreria basura ;

cuerpo_funcion: pr_bloque NEWLINE* ((llamadafuncion|asignacion|control|declaracion)NEWLINE*)* pr_bloque ;
cuerpo_control: pr_bloque NEWLINE* ((llamadafuncion|asignacion|control|declaracion)NEWLINE*)* pr_bloque ;
header_funcion : pr_funcion nombre_funcion parametros tipo_devolucion ;
header_control: pr_control parametros? ;


//PALABRAS RESERVADAS
FUNCTION: 'function';
INCLUDE: 'include' ;
WHILE: 'while' ;
IF: 'if' ;
ELSE: 'else' ;
BEGIN: 'begin' ;
END: 'end' ;
TIPO: ('numero'|'cadena'|'void') ;

//EXPRESIONES
arg: (TIPO ID((','|', ')TIPO ID)*)? ;
expr: expr ('*'|'/') expr
    | expr ('+' | '-') expr
    | expr ('=='|'!='|'<'|'>'|'<='|'>=') expr
    | expr (','|', ') expr
    | ID parametros
    | llamadafuncion//ID PI ((numero|ID|cadena|flotante)((','|', ')(numero|ID|cadena|flotante))*)? PD NEWLINE?
    | numero NEWLINE?            //
    | cadena NEWLINE?           // Los NEWLINE? son para el caso en el cual haya varias lineas para refernciar   
    | flotante NEWLINE?        // a parametros, asignaciones de variables...
    | ID NEWLINE?             //            
    ;

//Palabras reservadas
pr_funcion: FUNCTION ;
pr_tipo: TIPO ;
pr_bloque: BEGIN | END ;
pr_control: IF | ELSE | WHILE ;
pr_include: INCLUDE ;

//Nombres
nombre_funcion: ID ;
nombre_variable: ID ;
nombre_libreria: ID ;

//Tipo de datos
cadena: STRING ;
numero: INT ;
flotante: FLOAT;
tipo_devolucion: basura pr_tipo ;

//Caracteres no importantes
basura: DOBLEPUNTO | FINAL | NEWLINE | ASIGNAR;

//Parametros
parametros: PI expr PD | PI arg PD;


//IDENTIFICADORES
ID: ID_LETRA(ID_LETRA|DIGITO)*;
fragment ID_LETRA: [a-zA-Z];
fragment DIGITO: [0-9];


//VARIABLES
INT: DIGITO+;
FLOAT: DIGITO+ '.' DIGITO*
        | '.' DIGITO+
        ;
STRING: '"' .*? '"';


//COMENTARIOS
COMENTARIO_LINEA: ('//' .*? '\n') -> skip ;
COMENTARIO_BLOQUE: ('/*' .*? '*/' NEWLINE) -> skip ;

//SALTO DE LINEA
NEWLINE: [\r\n]+;

//CARACTERES ESPECIALES
PI: '(' ;
PD: ')' ;
FINAL: ';' ;
ASIGNAR: ':=' ;
DOBLEPUNTO: ':';
WS: ' '+ -> skip;
TAB: '\t'+ -> skip;