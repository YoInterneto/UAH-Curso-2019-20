#|=====================================================================
   Func: estaFila : list number number number -> boolean
   Obj: Devuelve #t cuando el numero esta en la fila y
        #f cuando no lo esta
  =====================================================================|#
(define (estaFila sudoku fila columna numero)



#|=====================================================================
   Func: estaColumna : list number number number -> boolean
   Obj: Devuelve #t cuando el numero esta en la columna y
        #f cuando no lo esta
  =====================================================================|#
(define (estaColumna sudoku columna fila numero)




#|===========================================================================
   Func: estaCuadrado list number number number number number -> boolean
   Obj: Devuelve #t cuando el numero esta en el cuadrado y
        #f cuando no lo esta
   Detalles: inicio y final son los valores que se iteran para recorrer el
             cuadrado, por otro lado fila y columna son los valores donde se
             encuentra el numero que se quiere comprobar y por tanto lo salta
  ===========================================================================|#
(define (estaCuadrado sudoku inicio final fila columna numero)



#|===============================================================
   Func: estaPermitido : list number number number -> boolean
   Obj: Devulve #t si el numero puede ponerse en esa posicion
        y #f si no puede
  ===============================================================|#
(define (estaPermitido sudoku fila columna numero)
  (if (or (estaCuadrado sudoku (- fila (remainder fila 3)) (- columna (remainder columna 3)) fila columna numero) ;aqui iria el que ve si esta en el mismo cuadro
          (estaFila sudoku fila columna numero)
          (estaColumna sudoku columna fila numero)
      )
      #f #t)
)


#|===============================================================
   Func: sudokuInicioCorrecto? : list -> boolean
   Obj: Devulve #t si el sudoku es correcto y #f si no lo es sin contar las posiciones
        del sudoku con un 0 (comprueba al inicio del sudoku)
  ===============================================================|#
(define (sudokuInicioCorrecto? sudoku)



#|===============================================================
   Func: sudokuFinalCorrecto? : list -> boolean
   Obj: Devuelve #t si el sudoku es correcto y #f, teniendo en cuenta que
        no puede haber ninguna posicion con 0 (comprueba al final de sudoku)
  ===============================================================|#
(define (sudokuFinalCorrecto? sudoku)


#|===============================================================
   Func: sucesores : list list number number list number string -> procedure
   Obj: Comprueba que sucesores puede haber en funcion de los posible valores
        permitidos en una posicion del sudoku, llamando finalmente a una funcion
        para insertar los valores en la lista de abiertos
   Detalles: contador es una varaible que toma valores entre 1-9 que son los
             posibles valores que puede haber en un sudoku
  ===============================================================|#
(define (sucesores listaAbiertos listaSucesores fila columna sudoku contador busqueda)



#|===============================================================
   Func: crearNodo : list number number number -> list
   Obj: Devuelve una lista con la información del nuevo nodo, introduciendo de uno en uno
        y de forma recusiva los valores (fila, columna, valor)
  ===============================================================|#
(define (crearNodo lista coord1 coord2 sudoku)



#|===============================================================
   Func: insertar : list list number number number -> list
   Obj: Devuelve la lista del sudoku después de insertar el nodo
  ===============================================================|#
(define (insertar lista lista2 fila columna numero contador)


#|===============================================================
   Func: printSudoku : list number number list -> 
   Obj: Método que muestra por pantalla, con un formato adecuado el sudoku que se pase
        como parámetro
  ===============================================================|#
(define (printSudoku sudoku)


(define matriz1 '((5 0 0 0 0 0 0 0 0)
                  (0 2 8 4 0 0 5 0 3)
                  (1 0 0 2 7 0 0 0 6)

                  (0 0 3 0 5 2 1 9 0)
                  (7 0 6 0 1 0 2 0 8)
                  (0 1 9 7 4 0 3 0 0)

                  (6 0 0 0 9 4 0 0 2)
                  (8 0 1 0 0 6 7 5 0)
                  (0 0 0 0 0 0 0 0 4)))

(define matriz3 '((0 0 4 0 3 0 0 6 0)
                  (1 6 0 0 0 2 0 3 0)
                  (9 0 2 8 0 6 4 5 0)

                  (0 0 0 0 6 0 9 1 0)
                  (0 0 0 0 0 0 0 0 0)
                  (0 1 8 0 5 0 0 0 0)

                  (0 2 6 1 0 5 3 0 4)
                  (0 7 0 6 0 0 0 8 2)
                  (0 4 0 0 2 0 6 0 0)))

(define matriz17'((3 0 8 0 0 0 0 0 0)
                  (0 0 0 0 4 0 5 0 7)
                  (6 7 0 0 5 8 0 1 9)

                  (1 8 0 0 0 0 0 0 0)
                  (7 9 0 8 2 3 0 4 5)
                  (0 0 0 0 0 0 0 9 3)

                  (4 6 0 7 8 0 0 3 1)
                  (2 0 9 0 1 0 0 0 0)
                  (0 0 0 0 0 0 4 0 6)))

(define matriz20'((8 0 0 4 6 0 0 0 0)
                  (0 0 0 0 1 0 0 0 9)
                  (0 7 0 3 0 8 6 0 0)

                  (2 0 0 0 0 0 0 9 0)
                  (3 8 0 0 7 0 0 2 1)
                  (0 5 0 0 0 0 0 0 8)

                  (0 0 4 5 0 6 0 1 0)
                  (5 0 0 4 0 0 0 0 0)
                  (0 0 0 0 9 3 0 0 6)))



     
     ;!!!!!!!!!!!!!!!¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡
     ;CREO QUE LO QUE ESTA COMENTADO ABAJO NO HACE FALTA, YA QUE TE DA IGUAL QUE ESTE O NO LA LISTA DE ABIERTOS VACIA PORQUE LA LLENAS ANTES DE LLAMAR
     ;A LA FUNCION DE FORMA RECURSIVA
     ;!!!!!!!!!!!!!!!¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡
     #|(cond
       ;si no hay ningun abierto en la lista entonces, no podremos coger ningun valor de ella
       [(null? listaAbiertos)
        ;si el numero de la posicion NO es 0 llamamos a la funcion igual, pero si no es 0 llamamos a la funcion con el sudoku que se genera
        ;en el primer nodo mas la nueva lista de abierto sin el primer nodo, en los dos casos iteramos el contador de columna
        (if (equal? (list-ref (list-ref sudoku filaC) columnaC) 0)
            ;si es 0 el numero de la posicion indicada
            (let ((abiertos (sucesores listaAbiertos '() filaC columnaC sudoku 1 busqueda)))
              (solucionSudoku (list-ref (sacar abiertos) 2) filaC (add1 columnaC) (eliminar abiertos) busqueda)
            )
              (solucionSudoku sudoku filaC (add1 columnaC) listaAbiertos busqueda)
         )
       ]
       ;si la lista de abiertos tiene cosas dentro, comprobamos si el numero de la posicion indicada es 0
       [else
        (if (equal? (list-ref (list-ref sudoku filaC) columnaC) 0)
            ;si es 0 "guardamos" en una variable la nueva lista de abiertos y llamamos a la funcion con la fila, columna y sudoku
            ;del primer nodo de la lista de abiertos
            (let ((abiertos (sucesores listaAbiertos '() filaC columnaC sudoku 1 busqueda)))
              (solucionSudoku (list-ref (sacar abiertos) 2) (list-ref (sacar abiertos) 0) (add1 (list-ref (sacar abiertos) 1)) (eliminar abiertos) busqueda)
            )
            ;si no es 0 seguimos iterado el sudoku
            (solucionSudoku sudoku filaC (add1 columnaC) listaAbiertos busqueda)
         )
       ]
     )|#


; test1
;+-------+-------+-------+
;| 5 0 0 | 0 0 0 | 0 0 0 |
;| 0 2 8 | 4 0 0 | 5 0 3 |
;| 1 0 0 | 2 7 0 | 0 0 6 |
;+-------+-------+-------+
;| 0 0 3 | 0 5 2 | 1 9 0 |
;| 7 0 6 | 0 1 0 | 2 0 8 |
;| 0 1 9 | 7 4 0 | 3 0 0 |
;+-------+-------+-------+
;| 6 0 0 | 0 9 4 | 0 0 2 |
;| 8 0 1 | 0 0 6 | 7 5 0 |
;| 0 0 0 | 0 0 0 | 0 0 4 |
;+-------+-------+-------+
; test1 posible sol 
;+-------+-------+-------+
;| 5 6 7 | 8 3 9 | 4 2 1 |
;| 9 2 8 | 4 6 1 | 5 7 3 |
;| 1 3 4 | 2 7 5 | 9 8 6 |
;+-------+-------+-------+
;| 4 8 3 | 6 5 2 | 1 9 7 |
;| 7 5 6 | 9 1 3 | 2 4 8 |
;| 2 1 9 | 7 4 8 | 3 6 5 |
;+-------+-------+-------+
;| 6 7 5 | 1 9 4 | 8 3 2 |
;| 8 4 1 | 3 2 6 | 7 5 9 |
;| 3 9 2 | 5 8 7 | 6 1 4 |
;+-------+-------+-------+

; test2
;+-------+-------+-------+
;| 5 6 0 | 0 0 4 | 1 0 0 |
;| 0 7 0 | 6 0 0 | 0 3 0 |
;| 0 0 0 | 1 2 0 | 0 6 0 |
;+-------+-------+-------+
;| 0 0 0 | 3 0 8 | 6 9 2 |
;| 0 8 0 | 0 7 0 | 0 4 0 |
;| 4 3 2 | 9 0 6 | 0 0 0 |
;+-------+-------+-------+
;| 0 5 0 | 0 9 7 | 0 0 0 |
;| 0 2 0 | 0 0 1 | 0 5 0 |
;| 0 0 9 | 5 0 0 | 0 8 6 | 
;+-------+-------+-------+

; test3
;+-------+-------+-------+
;| 0 0 4 | 0 3 0 | 0 6 0 |
;| 1 6 0 | 0 0 2 | 0 3 0 |
;| 9 0 2 | 8 0 6 | 4 5 0 |
;+-------+-------+-------+
;| 0 0 0 | 0 6 0 | 9 1 0 |
;| 0 0 0 | 0 0 0 | 0 0 0 |
;| 0 1 8 | 0 5 0 | 0 0 0 |
;+-------+-------+-------+
;| 0 2 6 | 1 0 5 | 3 0 4 |
;| 0 7 0 | 6 0 0 | 0 8 2 |
;| 0 4 0 | 0 2 0 | 6 0 0 |
;+-------+-------+-------+

; test4 
;+-------+-------+-------+
;| 0 0 0 | 0 0 4 | 8 0 0 |
;| 0 2 0 | 0 0 3 | 0 1 0 |
;| 6 0 1 | 0 0 0 | 7 0 5 |
;+-------+-------+-------+
;| 5 8 0 | 0 0 9 | 0 7 0 |
;| 0 0 4 | 0 0 0 | 5 0 0 |
;| 0 1 0 | 7 0 0 | 0 8 6 |
;+-------+-------+-------+
;| 4 0 3 | 0 0 0 | 9 0 2 |
;| 0 6 0 | 3 0 0 | 0 4 0 |
;| 0 0 2 | 6 0 0 | 0 0 0 |
;+-------+-------+-------+

;test5           | 
;+-------+-------+-------+
;| 9 0 8 | 0 0 2 | 0 0 0 |
;| 0 0 0 | 0 7 0 | 0 5 8 |
;| 0 7 0 | 0 0 9 | 0 0 0 |
;+-------+-------+-------+
;| 0 9 4 | 0 1 8 | 5 0 7 |
;| 5 0 0 | 0 9 0 | 0 0 1 |
;| 2 0 1 | 7 6 0 | 3 9 0 |
;+-------+-------+-------+
;| 0 0 0 | 5 0 0 | 0 3 0 |
;| 8 1 0 | 0 3 0 | 0 0 0 |
;| 0 0 0 | 9 0 0 | 7 0 6 |
;+-------+-------+-------+

; test6
;+-------+-------+-------+
;| 0 1 0 | 9 4 2 | 7 0 0 |
;| 0 0 0 | 6 0 0 | 2 0 0 |
;| 2 0 0 | 0 7 1 | 9 0 0 |
;+-------+-------+-------+
;| 4 8 0 | 0 0 0 | 0 0 2 |
;| 7 0 0 | 0 0 0 | 0 0 9 |
;| 1 0 0 | 0 0 0 | 0 8 6 |
;+-------+-------+-------+
;| 0 0 7 | 8 2 0 | 0 0 1 |
;| 0 0 1 | 0 0 9 | 0 0 0 |
;| 0 0 8 | 5 1 6 | 0 2 0 |
;+-------+-------+-------+

; test7
;+-------+-------+-------+
;| 6 1 0 | 3 5 4 | 0 9 0 |
;| 0 9 0 | 0 0 0 | 0 0 4 |
;| 8 4 0 | 0 9 0 | 6 1 0 |
;+-------+-------+-------+
;| 0 3 0 | 4 0 0 | 8 0 0 |
;| 0 0 0 | 9 6 1 | 0 0 0 |
;| 0 0 1 | 0 0 3 | 0 5 0 |
;+-------+-------+-------+
;| 0 6 4 | 0 3 0 | 0 8 2 |
;| 2 0 0 | 0 0 0 | 0 3 0 |
;| 0 8 0 | 5 1 2 | 0 6 9 |
;+-------+-------+-------+

; test8
;+-------+-------+-------+
;| 5 0 0 | 3 4 0 | 0 0 1 |
;| 0 1 4 | 0 0 6 | 3 7 0 |
;| 7 0 3 | 9 0 8 | 4 0 0 |
;+-------+-------+-------+
;| 2 7 9 | 0 0 0 | 0 0 0 |
;| 0 4 0 | 0 0 0 | 0 3 0 |
;| 0 0 0 | 0 0 0 | 6 1 7 |
;+-------+-------+-------+
;| 0 0 7 | 2 0 3 | 8 0 6 |
;| 0 5 6 | 8 0 0 | 1 2 0 |
;| 8 0 0 | 0 6 4 | 0 0 9 |
;+-------+-------+-------+

; test9
;+-------+-------+-------+
;| 0 0 5 | 0 0 7 | 0 6 8 |
;| 0 0 0 | 0 0 0 | 0 0 0 |
;| 9 8 0 | 6 3 0 | 2 7 0 |
;+-------+-------+-------+
;| 0 0 6 | 1 0 0 | 0 2 4 |
;| 0 0 0 | 0 4 0 | 0 0 0 |
;| 2 3 0 | 0 0 8 | 9 0 0 |
;+-------+-------+-------+
;| 0 5 8 | 0 1 3 | 0 9 2 |
;| 0 0 0 | 0 0 0 | 0 0 0 |
;| 4 6 0 | 2 0 0 | 5 0 0 |
;+-------+-------+-------+

; test10
;+-------+-------+-------+
;| 1 0 0 | 0 9 6 | 0 0 0 |
;| 0 9 0 | 3 5 7 | 0 6 8 |
;| 0 0 0 | 0 8 0 | 7 0 0 |
;+-------+-------+-------+
;| 0 1 0 | 7 0 0 | 6 5 0 |
;| 0 0 0 | 0 0 0 | 0 0 0 |
;| 0 3 4 | 0 0 9 | 0 8 0 |
;+-------+-------+-------+
;| 0 0 1 | 0 7 0 | 0 0 0 |
;| 9 8 0 | 1 6 4 | 0 7 0 |
;| 0 0 0 | 5 3 0 | 0 0 6 |
;+-------+-------+-------+

; test11
;+-------+-------+-------+
;| 0 0 0 | 2 1 9 | 0 0 6 |
;| 0 2 7 | 6 0 0 | 0 0 5 |
;| 0 0 0 | 5 0 3 | 8 0 0 |
;+-------+-------+-------+
;| 1 0 0 | 0 9 0 | 0 6 0 |
;| 7 0 0 | 1 0 8 | 0 0 3 |
;| 0 9 0 | 0 4 0 | 0 0 7 |
;+-------+-------+-------+
;| 0 0 9 | 8 0 1 | 0 0 0 |
;| 8 0 0 | 0 0 6 | 5 3 0 |
;| 5 0 0 | 9 3 7 | 0 0 0 |
;+-------+-------+-------+

; test12
;+-------+-------+-------+
;| 3 5 0 | 2 0 0 | 8 9 0 |
;| 0 4 0 | 7 0 8 | 0 0 0 |
;| 1 0 8 | 0 3 0 | 0 0 0 |
;+-------+-------+-------+
;| 4 0 5 | 0 7 2 | 0 1 0 |
;| 0 0 6 | 8 0 1 | 9 0 0 |
;| 0 9 0 | 3 5 0 | 2 0 7 |
;+-------+-------+-------+
;| 0 0 0 | 0 2 0 | 3 0 5 |
;| 0 0 0 | 6 0 5 | 0 2 0 |
;| 0 1 2 | 0 0 3 | 0 6 9 |
;+-------+-------+-------+

; test13
;+-------+-------+-------+
;| 1 6 0 | 9 3 0 | 0 8 0 |
;| 0 0 0 | 1 0 0 | 0 0 9 |
;| 0 0 0 | 8 5 0 | 1 3 0 |
;+-------+-------+-------+
;| 9 0 5 | 0 1 0 | 6 4 2 |
;| 0 0 0 | 0 0 0 | 0 0 0 |
;| 4 8 2 | 0 6 0 | 5 0 1 |
;+-------+-------+-------+
;| 0 4 3 | 0 8 2 | 0 0 0 |
;| 5 0 0 | 0 0 3 | 0 0 0 |
;| 0 2 0 | 0 9 1 | 0 5 6 |
;+-------+-------+-------+

; test14
;+-------+-------+-------+
;| 0 0 0 | 0 6 3 | 0 5 4 |
;| 1 0 5 | 7 0 0 | 0 2 3 |
;| 0 6 7 | 0 0 2 | 0 0 0 |
;+-------+-------+-------+
;| 0 0 0 | 0 4 0 | 3 8 6 |
;| 8 0 0 | 5 0 6 | 0 0 1 |
;| 4 1 6 | 0 9 0 | 0 0 0 |
;+-------+-------+-------+
;| 0 0 0 | 8 0 0 | 1 6 0 |
;| 6 3 0 | 0 0 7 | 8 0 5 |
;| 7 8 0 | 6 1 0 | 0 0 0 |
;+-------+-------+-------+

; test15
;+-------+-------+-------+
;| 0 5 4 | 6 2 0 | 0 0 0 |
;| 6 0 7 | 0 0 8 | 0 3 1 |
;| 8 0 0 | 0 0 5 | 2 0 4 |
;+-------+-------+-------+
;| 0 0 0 | 9 0 1 | 0 7 0 |
;| 7 0 0 | 5 0 4 | 0 0 6 |
;| 0 9 0 | 7 0 2 | 0 0 0 |
;+-------+-------+-------+
;| 3 0 1 | 8 0 0 | 0 0 2 |
;| 2 8 0 | 3 0 0 | 4 0 9 |
;| 0 0 0 | 0 1 6 | 3 8 0 |
;+-------+-------+-------+

; test16
;+-------+-------+-------+
;| 9 7 0 | 0 0 3 | 4 5 0 |
;| 1 0 0 | 0 2 4 | 0 3 0 |
;| 4 3 0 | 0 0 9 | 2 0 6 |
;+-------+-------+-------+
;| 7 0 4 | 8 0 0 | 0 0 0 |
;| 0 9 0 | 0 0 0 | 0 8 0 |
;| 0 0 0 | 0 0 2 | 7 0 5 |
;+-------+-------+-------+
;| 2 0 7 | 9 0 0 | 0 6 8 |
;| 0 4 0 | 3 6 0 | 0 0 7 |
;| 0 5 3 | 2 0 0 | 0 9 4 |
;+-------+-------+-------+

; test17
;+-------+-------+-------+
;| 3 0 8 | 0 0 0 | 0 0 0 |
;| 0 0 0 | 0 4 0 | 5 0 7 |
;| 6 7 0 | 0 5 8 | 0 1 9 |
;+-------+-------+-------+
;| 1 8 0 | 0 0 0 | 0 0 0 |
;| 7 9 0 | 8 2 3 | 0 4 5 |
;| 0 0 0 | 0 0 0 | 0 9 3 |
;+-------+-------+-------+
;| 4 6 0 | 7 8 0 | 0 3 1 |
;| 2 0 9 | 0 1 0 | 0 0 0 |
;| 0 0 0 | 0 0 0 | 4 0 6 |
;+-------+-------+-------+

; test18
;+-------+-------+-------+
;| 0 7 6 | 0 0 3 | 0 0 0 |
;| 0 0 0 | 8 0 0 | 6 0 0 |
;| 3 0 0 | 0 5 0 | 0 2 4 |
;+-------+-------+-------+
;| 7 8 3 | 5 0 0 | 0 9 0 |
;| 1 2 9 | 6 0 8 | 7 4 5 |
;| 0 4 0 | 0 0 7 | 8 1 3 |
;+-------+-------+-------+
;| 8 5 0 | 0 6 0 | 0 0 2 |
;| 0 0 7 | 0 0 1 | 0 0 0 |
;| 0 0 0 | 4 0 0 | 3 8 0 |
;+-------+-------+-------+

; test19
;+-------+-------+-------+
;| 0 0 0 | 0 0 8 | 0 0 0 |
;| 3 0 8 | 0 0 0 | 7 0 0 |
;| 2 9 4 | 7 0 0 | 0 8 1 |
;+-------+-------+-------+
;| 4 0 0 | 8 6 0 | 0 7 0 |
;| 0 0 0 | 0 0 0 | 0 0 0 |
;| 0 7 0 | 0 9 2 | 0 0 6 |
;+-------+-------+-------+
;| 6 5 0 | 0 0 1 | 2 4 3 |
;| 0 0 3 | 0 0 0 | 8 0 9 |
;| 0 0 0 | 5 0 0 | 0 0 0 |
;+-------+-------+-------+

; test20
;+-------+-------+-------+
;| 8 0 0 | 4 6 0 | 0 0 0 |
;| 0 0 0 | 0 1 0 | 0 0 9 |
;| 0 7 0 | 3 0 8 | 6 0 0 |
;+-------+-------+-------+
;| 2 0 0 | 0 0 0 | 0 9 0 |
;| 3 8 0 | 0 7 0 | 0 2 1 |
;| 0 5 0 | 0 0 0 | 0 0 8 |
;+-------+-------+-------+
;| 0 0 4 | 5 0 6 | 0 1 0 |
;| 5 0 0 | 4 0 0 | 0 0 0 |
;| 0 0 0 | 0 9 3 | 0 0 6 |
;+-------+-------+-------+
